<div class="max-w-4xl mx-auto p-6 bg-white shadow-lg rounded-lg">
  <div class="mb-6">
    <h2 class="text-3xl font-bold text-gray-800">
      <%= curriculum.new_record? ? "Registrar Currículum" : "Editar Currículum" %>
    </h2>
  </div>

  <% if curriculum.errors.any? %>
    <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded">
      <h3 class="text-lg font-semibold text-red-800 mb-2">Errores encontrados:</h3>
      <ul class="list-disc list-inside space-y-1 text-red-700">
          <% curriculum.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
      </ul>
    </div>
  <% end %>

  <%= form_with(model: curriculum, local: true) do |form| %>
    <fieldset>
      <legend>Datos Personales</legend>

      <!-- Foto de Perfil -->
      <div class="mb-4">
        <%= form.label :photo, "Foto de Perfil (JPEG o PNG, máximo 2 MB)", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.file_field :photo, accept: "image/jpeg,image/png", class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
        <% if curriculum.persisted? && curriculum.photo.attached? %>
          <div class="current-photo">
            <img src="<%= url_for(curriculum.photo) %>" alt="Foto de perfil" class="photo-preview-img">
            <p>Foto actual</p>
          </div>
        <% end %>
      </div>

      <!-- Nombre -->
      <div class="mb-4">
        <%= form.label :first_name, "Nombre(s)", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.text_field :first_name, placeholder: "Ej: Juan", class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>

      <!-- Apellido -->
      <div class="mb-4">
        <%= form.label :last_name, "Apellidos", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.text_field :last_name, placeholder: "Ej: Pérez García", class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>

      <!-- Fecha de Nacimiento -->
      <div class="mb-4">
        <%= form.label :birth_date, "Fecha de Nacimiento (debes ser mayor de 18 años)", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.date_field :birth_date, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>

      <!-- Identificación -->
      <div class="mb-4">
        <%= form.label :identification, "Número de Identificación", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.text_field :identification, placeholder: "Ej: 1234567890", class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>

      <!-- Teléfono -->
      <div class="mb-4">
        <%= form.label :phone_number, "Teléfono", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.text_field :phone_number, placeholder: "Ej: +57 300 1234567", class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>

      <!-- Dirección -->
      <div class="mb-4">
        <%= form.label :address, "Dirección de Residencia", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.text_field :address, placeholder: "Ej: Carrera 5", class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
      </div>

      <!-- Ubicación con Stimulus -->
      <div data-controller="location" 
           data-location-initial-department-value="<%= curriculum.department %>"
           data-location-initial-city-value="<%= curriculum.city %>">
        
        <!-- País -->
        <div class="mb-4">
          <%= form.label :country, "País", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.select :country, 
            [
              "Afganistán", "Albania", "Alemania", "Andorra", "Angola", "Antigua y Barbuda", "Arabia Saudita", "Argelia", "Argentina", "Armenia", "Australia", "Austria", "Azerbaiyán",
              "Bahamas", "Bangladés", "Barbados", "Baréin", "Bélgica", "Belice", "Benín", "Bielorrusia", "Birmania", "Bolivia", "Bosnia y Herzegovina", "Botsuana", "Brasil", "Brunéi", "Bulgaria", "Burkina Faso", "Burundi", "Bután",
              "Cabo Verde", "Camboya", "Camerún", "Canadá", "Catar", "Chad", "Chile", "China", "Chipre", "Ciudad del Vaticano", "Colombia", "Comoras", "Corea del Norte", "Corea del Sur", "Costa de Marfil", "Costa Rica", "Croacia", "Cuba",
              "Dinamarca", "Dominica",
              "Ecuador", "Egipto", "El Salvador", "Emiratos Árabes Unidos", "Eritrea", "Eslovaquia", "Eslovenia", "España", "Estados Unidos", "Estonia", "Etiopía",
              "Filipinas", "Finlandia", "Fiyi", "Francia",
              "Gabón", "Gambia", "Georgia", "Ghana", "Granada", "Grecia", "Guatemala", "Guinea", "Guinea Ecuatorial", "Guinea-Bisáu", "Guyana",
              "Haití", "Honduras", "Hungría",
              "India", "Indonesia", "Irak", "Irán", "Irlanda", "Islandia", "Islas Marshall", "Islas Salomón", "Israel", "Italia",
              "Jamaica", "Japón", "Jordania",
              "Kazajistán", "Kenia", "Kirguistán", "Kiribati", "Kuwait",
              "Laos", "Lesoto", "Letonia", "Líbano", "Liberia", "Libia", "Liechtenstein", "Lituania", "Luxemburgo",
              "Madagascar", "Malasia", "Malaui", "Maldivas", "Malí", "Malta", "Marruecos", "Mauricio", "Mauritania", "México", "Micronesia", "Moldavia", "Mónaco", "Mongolia", "Montenegro", "Mozambique",
              "Namibia", "Nauru", "Nepal", "Nicaragua", "Níger", "Nigeria", "Noruega", "Nueva Zelanda",
              "Omán",
              "Países Bajos", "Pakistán", "Palaos", "Panamá", "Papúa Nueva Guinea", "Paraguay", "Perú", "Polonia", "Portugal",
              "Reino Unido", "República Centroafricana", "República Checa", "República del Congo", "República Democrática del Congo", "República Dominicana", "Ruanda", "Rumania", "Rusia",
              "Samoa", "San Cristóbal y Nieves", "San Marino", "San Vicente y las Granadinas", "Santa Lucía", "Santo Tomé y Príncipe", "Senegal", "Serbia", "Seychelles", "Sierra Leona", "Singapur", "Siria", "Somalia", "Sri Lanka", "Suazilandia", "Sudáfrica", "Sudán", "Sudán del Sur", "Suecia", "Suiza", "Surinam",
              "Tailandia", "Tanzania", "Tayikistán", "Timor Oriental", "Togo", "Tonga", "Trinidad y Tobago", "Túnez", "Turkmenistán", "Turquía", "Tuvalu",
              "Ucrania", "Uganda", "Uruguay", "Uzbekistán",
              "Vanuatu", "Venezuela", "Vietnam",
              "Yemen",
              "Yibuti",
              "Zambia", "Zimbabue"
            ],
            { prompt: "Seleccionar país", selected: curriculum.country.present? ? curriculum.country : "Colombia" },
            { 
              class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",
              data: { location_target: "country", action: "change->location#countryChanged" }
            }
          %>
        </div>

        <!-- Departamento -->
        <div class="mb-4">
          <%= form.label :department, "Departamento/Región", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <div data-location-target="departmentContainer">
            <%= form.text_field :department, placeholder: "Ej: Cundinamarca", class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
          </div>
        </div>

        <!-- Ciudad -->
        <div class="mb-4">
          <%= form.label :city, "Ciudad", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <div data-location-target="cityContainer">
            <%= form.text_field :city, placeholder: "Ej: Bogotá", class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
          </div>
        </div>
      </div>

      <!-- Perfil/Descripción Personal -->
      <div class="mb-4">
        <%= form.label :profile_description, "Perfil o Descripción Personal", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.text_area :profile_description, placeholder: "Describe tu perfil profesional...", rows: 5, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
        <small class="text-sm text-gray-500">Máximo 2000 caracteres</small>
      </div>

      <!-- Disponibilidad para Viajar -->
      <div class="mb-4">
        <%= form.label :available_to_travel, "¿Disponibilidad para Viajar?", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <div class="flex items-center space-x-4">
          <label class="inline-flex items-center">
            <%= form.radio_button :available_to_travel, true, class: "mr-2" %>
            <span>Sí</span>
          </label>
          <label class="inline-flex items-center">
            <%= form.radio_button :available_to_travel, false, class: "mr-2" %>
            <span>No</span>
          </label>
        </div>
      </div>

      <!-- Disponibilidad para Cambio de Residencia -->
      <div class="mb-4">
        <%= form.label :available_to_relocate, "¿Disponibilidad para Cambio de Residencia?", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <div class="flex items-center space-x-4">
          <label class="inline-flex items-center">
            <%= form.radio_button :available_to_relocate, true, class: "mr-2" %>
            <span>Sí</span>
          </label>
          <label class="inline-flex items-center">
            <%= form.radio_button :available_to_relocate, false, class: "mr-2" %>
            <span>No</span>
          </label>
        </div>
      </div>

      <!-- Idiomas con Stimulus -->
      <div class="mb-4" data-controller="languages">
        <%= form.label :languages, "Idiomas", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <div class="space-y-3">
          <div class="flex items-center">
            <label class="inline-flex items-center">
              <input type="checkbox" name="curriculum[languages][]" value="Español" <% if (curriculum.languages || []).include?('Español') %>checked<% end %> class="mr-2 rounded">
              <span>Español</span>
            </label>
          </div>
          <div class="flex items-center">
            <label class="inline-flex items-center">
              <input type="checkbox" name="curriculum[languages][]" value="Inglés" <% if (curriculum.languages || []).include?('Inglés') %>checked<% end %> class="mr-2 rounded">
              <span>Inglés</span>
            </label>
          </div>
          <div class="mt-4">
            <p class="text-sm font-medium text-gray-700 mb-2">Otros idiomas:</p>
            <div data-languages-target="container" class="space-y-2">
              <% (curriculum.languages || []).reject { |lang| ['Español', 'Inglés'].include?(lang) }.each do |lang| %>
                <div class="flex items-center">
                  <input type="hidden" name="curriculum[languages][]" value="<%= lang %>">
                  <span class="mr-3 text-gray-700"><%= lang %></span>
                  <button type="button" 
                          data-action="click->languages#removeLanguage" 
                          class="bg-red-500 hover:bg-red-600 text-white text-xs px-3 py-1 rounded">
                    Eliminar
                  </button>
                </div>
              <% end %>
            </div>
            <div class="flex gap-2 mt-3">
              <input type="text" 
                     data-languages-target="input" 
                     placeholder="Ej: Portugués, Francés, etc." 
                     class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              <button type="button" 
                      data-action="click->languages#addLanguage" 
                      class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
                Agregar
              </button>
            </div>
          </div>
          <input type="hidden" name="curriculum[languages][]" value="">
        </div>
      </div>

      <!-- Información Académica con Stimulus -->
      <div class="mt-8" data-controller="studies">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">Información Académica</h3>
        
        <!-- Nivel de Estudios (fuera del panel) -->
        <div class="flex items-end gap-3 mb-4">
          <div class="flex-1">
            <%= form.label :education_level, "Nivel de Estudios", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.select :education_level, 
              [
                ['Ninguno', 'ninguno'], 
                ['Primaria', 'primaria'], 
                ['Secundaria', 'secundaria'], 
                ['Técnico', 'tecnico'], 
                ['Tecnólogo', 'tecnologico'], 
                ['Profesional', 'profesional'], 
                ['Posgrado', 'posgrado']
              ], 
              { prompt: 'Escoja el nivel de estudios' }, 
              { 
                class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",
                data: { studies_target: "educationLevel", action: "change->studies#educationLevelChanged" }
              } 
            %>
          </div>
          <button type="button" 
                  data-studies-target="button"
                  data-action="click->studies#addStudy" 
                  class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md whitespace-nowrap opacity-50 cursor-not-allowed disabled:opacity-50" 
                  title="Pulse para agregar un estudio realizado"
                  disabled>
            + Agregar Estudio
          </button>
        </div>
        
        <div data-studies-target="container" class="space-y-4">
          <%= form.fields_for :studies do |study_form| %>
            <div class="border border-gray-300 rounded-lg p-4 bg-gray-50">
              <div class="flex justify-between items-center mb-4">
                <h4 class="text-lg font-semibold text-gray-800">Estudio</h4>
                <%= study_form.check_box :_destroy, style: "display: none;" %>
                <button type="button" 
                        data-action="click->studies#removeStudy" 
                        class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                  Eliminar
                </button>
              </div>

              <div class="mb-3">
                <%= study_form.label :institution, "Institución *", class: "block text-sm font-medium text-gray-700 mb-2" %>
                <%= study_form.text_field :institution, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
              </div>

              <div class="mb-3">
                <%= study_form.label :status, "Estado", class: "block text-sm font-medium text-gray-700 mb-2" %>
                <%= study_form.select :status, [['Cursando', 'cursando'], ['Pausado', 'pausado'], ['Finalizado', 'finalizado']], { include_blank: 'Seleccionar' }, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
              </div>

              <div class="grid grid-cols-2 gap-4 mb-3">
                <div>
                  <%= study_form.label :start_date, "Fecha Inicio", class: "block text-sm font-medium text-gray-700 mb-2" %>
                  <%= study_form.date_field :start_date, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
                </div>
                <div>
                  <%= study_form.label :end_date, "Fecha Fin", class: "block text-sm font-medium text-gray-700 mb-2" %>
                  <%= study_form.date_field :end_date, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
                </div>
              </div>

              <div>
                <%= study_form.label :title, "Título", class: "block text-sm font-medium text-gray-700 mb-2" %>
                <%= study_form.text_field :title, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </fieldset>

    <!-- Botones de acción -->
    <div class="flex gap-4 mt-8">
      <% submit_text = curriculum.new_record? ? "Registrar Currículum" : "Actualizar Currículum" %>
      <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-3 rounded-md"><%= submit_text %></button>
      <%= link_to "Cancelar", root_path, class: "flex-1 bg-gray-500 hover:bg-gray-600 text-white font-semibold px-6 py-3 rounded-md text-center no-underline" %>
    </div>
  <% end %>
</div>

