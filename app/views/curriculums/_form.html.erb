<div class="form-container">
  <div class="form-header">
    <h2>
      <%= curriculum.new_record? ? "Registrar Currículum" : "Editar Currículum" %>
    </h2>
  </div>

  <% if curriculum.errors.any? %>
    <div class="alert alert-danger">
      <h3 class="alert-title">Errores encontrados:</h3>
      <ul class="alert-list">
          <% curriculum.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
      </ul>
    </div>
  <% end %>

  <%= form_with(model: curriculum, local: true) do |form| %>
    <fieldset>
      <legend>Datos Personales</legend>

      <!-- Foto de Perfil -->
      <div class="form-group">
        <%= form.label :photo, "Foto de Perfil (JPEG o PNG, máximo 2 MB)" %>
        <%= form.file_field :photo, accept: "image/jpeg,image/png", style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
        <% if curriculum.persisted? && curriculum.photo.attached? %>
          <div class="current-photo">
            <img src="<%= url_for(curriculum.photo) %>" alt="Foto de perfil" class="photo-preview-img">
            <p>Foto actual</p>
          </div>
        <% end %>
      </div>

      <!-- Nombre -->
      <div class="form-group">
        <%= form.label :first_name, "Nombre(s)" %>
        <%= form.text_field :first_name, placeholder: "Ej: Juan", style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
      </div>

      <!-- Apellido -->
      <div class="form-group">
        <%= form.label :last_name, "Apellidos" %>
        <%= form.text_field :last_name, placeholder: "Ej: Pérez García", style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
      </div>

      <!-- Fecha de Nacimiento -->
      <div class="form-group">
        <%= form.label :birth_date, "Fecha de Nacimiento (debes ser mayor de 18 años)" %>
        <%= form.date_field :birth_date, style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
      </div>

      <!-- Identificación -->
      <div class="form-group">
        <%= form.label :identification, "Número de Identificación" %>
        <%= form.text_field :identification, placeholder: "Ej: 1234567890", style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
      </div>

      <!-- Teléfono -->
      <div class="form-group">
        <%= form.label :phone_number, "Teléfono" %>
        <%= form.text_field :phone_number, placeholder: "Ej: +57 300 1234567", style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
      </div>

      <!-- Dirección -->
      <div class="form-group">
        <%= form.label :address, "Dirección de Residencia" %>
        <%= form.text_field :address, placeholder: "Ej: Carrera 5", style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
      </div>

      <!-- País -->
      <div class="form-group">
        <%= form.label :country, "País" %>
        <%= form.select :country, 
          [
            "Afganistán", "Albania", "Alemania", "Andorra", "Angola", "Antigua y Barbuda", "Arabia Saudita", "Argelia", "Argentina", "Armenia", "Australia", "Austria", "Azerbaiyán",
            "Bahamas", "Bangladés", "Barbados", "Baréin", "Bélgica", "Belice", "Benín", "Bielorrusia", "Birmania", "Bolivia", "Bosnia y Herzegovina", "Botsuana", "Brasil", "Brunéi", "Bulgaria", "Burkina Faso", "Burundi", "Bután",
            "Cabo Verde", "Camboya", "Camerún", "Canadá", "Catar", "Chad", "Chile", "China", "Chipre", "Ciudad del Vaticano", "Colombia", "Comoras", "Corea del Norte", "Corea del Sur", "Costa de Marfil", "Costa Rica", "Croacia", "Cuba",
            "Dinamarca", "Dominica",
            "Ecuador", "Egipto", "El Salvador", "Emiratos Árabes Unidos", "Eritrea", "Eslovaquia", "Eslovenia", "España", "Estados Unidos", "Estonia", "Etiopía",
            "Filipinas", "Finlandia", "Fiyi", "Francia",
            "Gabón", "Gambia", "Georgia", "Ghana", "Granada", "Grecia", "Guatemala", "Guinea", "Guinea Ecuatorial", "Guinea-Bisáu", "Guyana",
            "Haití", "Honduras", "Hungría",
            "India", "Indonesia", "Irak", "Irán", "Irlanda", "Islandia", "Islas Marshall", "Islas Salomón", "Israel", "Italia",
            "Jamaica", "Japón", "Jordania",
            "Kazajistán", "Kenia", "Kirguistán", "Kiribati", "Kuwait",
            "Laos", "Lesoto", "Letonia", "Líbano", "Liberia", "Libia", "Liechtenstein", "Lituania", "Luxemburgo",
            "Madagascar", "Malasia", "Malaui", "Maldivas", "Malí", "Malta", "Marruecos", "Mauricio", "Mauritania", "México", "Micronesia", "Moldavia", "Mónaco", "Mongolia", "Montenegro", "Mozambique",
            "Namibia", "Nauru", "Nepal", "Nicaragua", "Níger", "Nigeria", "Noruega", "Nueva Zelanda",
            "Omán",
            "Países Bajos", "Pakistán", "Palaos", "Panamá", "Papúa Nueva Guinea", "Paraguay", "Perú", "Polonia", "Portugal",
            "Reino Unido", "República Centroafricana", "República Checa", "República del Congo", "República Democrática del Congo", "República Dominicana", "Ruanda", "Rumania", "Rusia",
            "Samoa", "San Cristóbal y Nieves", "San Marino", "San Vicente y las Granadinas", "Santa Lucía", "Santo Tomé y Príncipe", "Senegal", "Serbia", "Seychelles", "Sierra Leona", "Singapur", "Siria", "Somalia", "Sri Lanka", "Suazilandia", "Sudáfrica", "Sudán", "Sudán del Sur", "Suecia", "Suiza", "Surinam",
            "Tailandia", "Tanzania", "Tayikistán", "Timor Oriental", "Togo", "Tonga", "Trinidad y Tobago", "Túnez", "Turkmenistán", "Turquía", "Tuvalu",
            "Ucrania", "Uganda", "Uruguay", "Uzbekistán",
            "Vanuatu", "Venezuela", "Vietnam",
            "Yemen",
            "Yibuti",
            "Zambia", "Zimbabue"
          ],
          { prompt: "Seleccionar país", selected: curriculum.country.present? ? curriculum.country : "Colombia" },
          { style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;", id: "country-select" }
        %>
      </div>

      <!-- Departamento -->
      <div class="form-group">
        <%= form.label :department, "Departamento/Región" %>
        <div id="department-container">
          <%= form.text_field :department, value: (curriculum.department.present? ? curriculum.department : "Córdoba"), placeholder: "Ej: Cundinamarca", style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;", id: "department-field" %>
        </div>
      </div>

      <!-- Ciudad -->
      <div class="form-group">
        <%= form.label :city, "Ciudad" %>
        <div id="city-container">
          <%= form.text_field :city, placeholder: "Ej: Bogotá", style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;", id: "city-field" %>
        </div>
      </div>

      <!-- Perfil/Descripción Personal -->
      <div class="form-group">
        <%= form.label :profile_description, "Perfil o Descripción Personal" %>
        <%= form.text_area :profile_description, placeholder: "Describe tu perfil profesional...", rows: 5, style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
        <small>Máximo 2000 caracteres</small>
      </div>

      <!-- Disponibilidad para Viajar -->
      <div class="form-group">
        <%= form.label :available_to_travel, "¿Disponibilidad para Viajar?" %>
        <div class="radio-group">
          <%= form.radio_button :available_to_travel, true %>
          <%= form.label :available_to_travel_true, "Sí" %>
          <%= form.radio_button :available_to_travel, false %>
          <%= form.label :available_to_travel_false, "No" %>
        </div>
      </div>

      <!-- Disponibilidad para Cambio de Residencia -->
      <div class="form-group">
        <%= form.label :available_to_relocate, "¿Disponibilidad para Cambio de Residencia?" %>
        <div class="radio-group">
          <%= form.radio_button :available_to_relocate, true %>
          <%= form.label :available_to_relocate_true, "Sí" %>
          <%= form.radio_button :available_to_relocate, false %>
          <%= form.label :available_to_relocate_false, "No" %>
        </div>
      </div>

      <!-- Idiomas -->
      <div class="form-group">
        <%= form.label :languages, "Idiomas" %>
        <div class="checkbox-container">
          <div class="checkbox-item">
            <label>
              <input type="checkbox" name="curriculum[languages][]" value="Español" <% if (curriculum.languages || []).include?('Español') %>checked<% end %>>
              Español
            </label>
          </div>
          <div class="checkbox-item">
            <label>
              <input type="checkbox" name="curriculum[languages][]" value="Inglés" <% if (curriculum.languages || []).include?('Inglés') %>checked<% end %>>
              Inglés
            </label>
          </div>
          <div class="other-languages-section">
            <p class="other-languages-label">Otros idiomas:</p>
            <div id="other-languages-container">
              <% (curriculum.languages || []).reject { |lang| ['Español', 'Inglés'].include?(lang) }.each do |lang| %>
                <div class="language-item">
                  <span><%= lang %></span>
                  <button type="button" class="remove-other-language" data-language="<%= lang %>" class="btn-remove">×</button>
                </div>
              <% end %>
            </div>
            <div class="language-input-group">
              <input type="text" id="new-other-language" placeholder="Ej: Portugués, Francés, etc." class="language-input">
              <button type="button" id="add-other-language-btn" class="btn btn-primary btn-sm">Agregar</button>
            </div>
            <input type="hidden" id="other-languages-hidden" name="curriculum[other_languages]" value="<% (curriculum.languages || []).reject { |lang| ['Español', 'Inglés'].include?(lang) }.join(',') %>">
          </div>
          <input type="hidden" name="curriculum[languages][]" value="">
        </div>
      </div>

      <!-- Información Académica -->
      <div class="academic-section">
        <h3>Información Académica</h3>
        
        <!-- Nivel de Estudios (fuera del panel) -->
        <div class="form-group">
          <%= form.label :education_level, "Nivel de Estudios", style: "display: block; margin-bottom: 5px; font-size: 14px; font-weight: 500;" %>
          <%= form.select :education_level, [['Ninguno', 'ninguno'], ['Primaria', 'primaria'], ['Secundaria', 'secundaria'], ['Técnico', 'tecnico'], ['Tecnológico', 'tecnologico'], ['Profesional', 'profesional'], ['Posgrado', 'posgrado']], { prompt: 'Escoja el nivel de estudios' }, style: "width: 100%; max-width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; box-sizing: border-box;", id: "education-level-select" %>
        </div>
        
        <div id="studies-container">
          <%= form.fields_for :studies do |study_form| %>
            <div class="study-panel study-fields">
              <div class="study-header">
                <h4>Estudio</h4>
                <%= study_form.check_box :_destroy, style: "display: none;" %>
                <button type="button" class="remove-study-btn" class="btn btn-danger btn-sm">Eliminar</button>
              </div>

              <div class="form-group">
                <%= study_form.label :institution, "Institución *", style: "display: block; margin-bottom: 5px; font-size: 14px; font-weight: 500;" %>
                <%= study_form.text_field :institution, style: "width: 100%; max-width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; box-sizing: border-box;" %>
              </div>

              <div class="form-group">
                <%= study_form.label :status, "Estado", style: "display: block; margin-bottom: 5px; font-size: 14px; font-weight: 500;" %>
                <%= study_form.select :status, [['Cursando', 'cursando'], ['Pausado', 'pausado'], ['Finalizado', 'finalizado']], { include_blank: 'Seleccionar' }, style: "width: 100%; max-width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; box-sizing: border-box;" %>
              </div>

              <div class="form-grid-2">
                <div>
                  <%= study_form.label :start_date, "Fecha Inicio", style: "display: block; margin-bottom: 5px; font-size: 14px; font-weight: 500;" %>
                  <%= study_form.date_field :start_date, style: "width: 100%; max-width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; box-sizing: border-box;" %>
                </div>
                <div>
                  <%= study_form.label :end_date, "Fecha Fin", style: "display: block; margin-bottom: 5px; font-size: 14px; font-weight: 500;" %>
                  <%= study_form.date_field :end_date, style: "width: 100%; max-width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; box-sizing: border-box;" %>
                </div>
              </div>

              <div class="form-group form-group-no-margin">
                <%= study_form.label :title, "Título", class: "form-label" %>
                <%= study_form.text_field :title, class: "form-control" %>
              </div>
            </div>
          <% end %>
        </div>

        <button type="button" id="add-study-btn" class="btn btn-primary btn-sm">+ Agregar Estudio</button>
      </div>
    </fieldset>

    <!-- Botones de acción -->
    <div class="form-actions">
      <% submit_text = curriculum.new_record? ? "Registrar Currículum" : "Actualizar Currículum" %>
      <button type="submit" class="btn btn-success btn-full"><%= submit_text %></button>
      <%= link_to "Cancelar", root_path, style: "flex: 1; padding: 10px; background-color: #6c757d; color: white; text-decoration: none; border-radius: 4px; text-align: center;" %>
    </div>
  <% end %>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Datos de ciudades por departamento de Colombia
  const citiesByDepartment = {
    'Córdoba': ['Montería', 'Cereté', 'Lorica', 'Sahagún', 'Montelíbano', 'Planeta Rica', 'Ayapel', 'Chinú', 'Ciénaga de Oro', 'Cotorra', 'La Apartada', 'Moñitos', 'Puerto Escondido', 'Pueblo Nuevo', 'San Andrés de Sotavento', 'San Antero', 'San Bernardo del Viento', 'San Carlos', 'San José de Uré', 'San Pelayo', 'Tierralta', 'Tuchín', 'Valencia', 'Buenavista', 'Canalete', 'Los Córdobas', 'Momil', 'Purísima', 'San Pelayo'],
    'Antioquia': ['Medellín', 'Bello', 'Itagüí', 'Envigado', 'Apartadó', 'Turbo', 'Rionegro', 'Caucasia', 'Sabaneta', 'La Ceja', 'Caldas', 'El Carmen de Viboral', 'Marinilla', 'La Estrella', 'Copacabana', 'Puerto Berrío', 'Necoclí', 'Carepa', 'Yarumal', 'Santa Rosa de Osos', 'Chigorodó', 'El Bagre', 'Guarne', 'Segovia', 'San Pedro de los Milagros', 'Urrao', 'Puerto Nare', 'Andes', 'Barbosa', 'Girardota'],
    'Atlántico': ['Barranquilla', 'Soledad', 'Malambo', 'Sabanalarga', 'Puerto Colombia', 'Galapa', 'Baranoa', 'Sabanagrande', 'Santo Tomás', 'Polonuevo', 'Palmar de Varela', 'Juan de Acosta', 'Usiacurí', 'Luruaco', 'Repelón', 'Manatí', 'Candelaria', 'Santa Lucía', 'Suan', 'Campo de la Cruz', 'Piojó', 'Tubará', 'Ponedera'],
    'Bolívar': ['Cartagena', 'Magangué', 'Turbaco', 'Arjona', 'El Carmen de Bolívar', 'Mompós', 'Sincelejo', 'San Juan Nepomuceno', 'María La Baja', 'Santa Rosa del Sur', 'Simití', 'San Pablo', 'Cantagallo', 'Cicuco', 'Santa Rosa', 'San Jacinto', 'San Estanislao', 'Clemencia', 'Mahates', 'Soplaviento', 'Marialabaja', 'Calamar', 'Arroyohondo'],
    'Boyacá': ['Tunja', 'Duitama', 'Sogamoso', 'Chiquinquirá', 'Paipa', 'Villa de Leyva', 'Moniquirá', 'Puerto Boyacá', 'Garagoa', 'Samacá', 'Ventaquemada', 'Ramiriquí', 'Nobsa', 'Tibasosa', 'Guateque', 'Soatá', 'Paz de Río', 'Sáchica', 'Togüí', 'Tópaga', 'Socha', 'Corrales', 'Tasco', 'Betéitiva', 'Socotá'],
    'Caldas': ['Manizales', 'La Dorada', 'Chinchiná', 'Villamaría', 'Riosucio', 'Aguadas', 'Anserma', 'Salamina', 'Supía', 'Pácora', 'Neira', 'Manzanares', 'Palestina', 'Aranzazu', 'Pensilvania', 'Marquetalia', 'Viterbo', 'Filadelfia', 'Victoria', 'Marulanda'],
    'Caquetá': ['Florencia', 'San Vicente del Caguán', 'Puerto Rico', 'El Doncello', 'El Paujil', 'La Montañita', 'Belén de los Andaquíes', 'Curillo', 'Albania', 'Cartagena del Chairá', 'Morelia', 'Milán', 'San José del Fragua', 'Solano', 'Valparaíso', 'Solita'],
    'Casanare': ['Yopal', 'Aguazul', 'Villanueva', 'Tauramena', 'Monterrey', 'Paz de Ariporo', 'Hato Corozal', 'Maní', 'Trinidad', 'Sabanalarga', 'Recetor', 'Nunchía', 'San Luis de Palenque', 'Orocué', 'Támara', 'Pore', 'La Salina', 'Sácama', 'Chameza'],
    'Cauca': ['Popayán', 'Santander de Quilichao', 'Puerto Tejada', 'Patía', 'Corinto', 'Miranda', 'Guapi', 'Piendamó', 'Timbío', 'Caloto', 'Villa Rica', 'Cajibío', 'El Tambo', 'Silvia', 'Bolívar', 'Mercaderes', 'Rosas', 'Buenos Aires', 'Suárez', 'López de Micay'],
    'Cesar': ['Valledupar', 'Aguachica', 'Bosconia', 'Codazzi', 'Chimichagua', 'La Jagua de Ibirico', 'Curumaní', 'Pelaya', 'Chiriguaná', 'El Copey', 'San Diego', 'La Paz', 'Pailitas', 'San Martín', 'Astrea', 'Tamalameque', 'Gamarra', 'La Gloria', 'Río de Oro', 'Manaure', 'González', 'Pueblo Bello', 'Becerril', 'San Alberto', 'Agustín Codazzi'],
    'Chocó': ['Quibdó', 'Istmina', 'Condoto', 'Tadó', 'Acandí', 'Bahía Solano', 'Bajo Baudó', 'Bojayá', 'Cértegui', 'El Carmen de Atrato', 'Litoral del San Juan', 'Lloró', 'Medio Atrato', 'Medio Baudó', 'Medio San Juan', 'Nóvita', 'Nuquí', 'Río Iro', 'Río Quito', 'Riosucio', 'San José del Palmar', 'Sipí', 'Unguía'],
    'Cundinamarca': ['Bogotá', 'Soacha', 'Facatativá', 'Zipaquirá', 'Chía', 'Fusagasugá', 'Girardot', 'Mosquera', 'Madrid', 'Funza', 'Cajicá', 'Sibaté', 'Tocancipá', 'La Calera', 'Sopó', 'Cota', 'Villeta', 'Tabio', 'Tenjo', 'Gachancipá', 'Guaduas', 'Ubaté', 'El Colegio', 'La Mesa', 'Anapoima', 'San Antonio del Tequendama', 'Arbeláez', 'Pacho', 'Chocontá', 'Agua de Dios'],
    'Huila': ['Neiva', 'Pitalito', 'Garzón', 'La Plata', 'Campoalegre', 'Algeciras', 'Gigante', 'Aipe', 'Hobo', 'Rivera', 'Palermo', 'Tello', 'San Agustín', 'Isnos', 'Saladoblanco', 'Timaná', 'Tarqui', 'Tesalia', 'Suaza', 'Acevedo', 'Guadalupe', 'Pitalito', 'Elías', 'Nátaga', 'Yaguará'],
    'La Guajira': ['Riohacha', 'Maicao', 'Uribia', 'Manaure', 'San Juan del Cesar', 'Villanueva', 'Fonseca', 'Dibulla', 'Distracción', 'Albania', 'Hatonuevo', 'Barrancas', 'El Molino', 'Urumita', 'La Jagua del Pilar'],
    'Magdalena': ['Santa Marta', 'Ciénaga', 'Fundación', 'Plato', 'Zona Bananera', 'El Banco', 'Aracataca', 'Pivijay', 'Santa Ana', 'Sabanas de San Ángel', 'San Zenón', 'Sitionuevo', 'Cerro de San Antonio', 'Concordia', 'El Piñón', 'El Retén', 'Guamal', 'Nueva Granada', 'Pedraza', 'Pijiño del Carmen', 'Puebloviejo', 'Remolino', 'Salamina', 'San Sebastián de Buenavista', 'Santa Bárbara de Pinto', 'Tenerife', 'Zapayán', 'Algarrobo', 'Ariguaní', 'Chivolo'],
    'Meta': ['Villavicencio', 'Acacías', 'Granada', 'Puerto López', 'Restrepo', 'San Martín', 'Cumaral', 'Guamal', 'San Carlos de Guaroa', 'Cabuyaro', 'Puerto Gaitán', 'Barranca de Upía', 'Castilla la Nueva', 'El Calvario', 'El Castillo', 'El Dorado', 'Fuente de Oro', 'La Macarena', 'Lejanías', 'Mapiripán', 'Mesetas', 'Puerto Concordia', 'Puerto Lleras', 'Puerto Rico', 'Uribe', 'Vista Hermosa'],
    'Nariño': ['Pasto', 'Tumaco', 'Ipiales', 'Túquerres', 'Samaniego', 'Barbacoas', 'La Unión', 'Sandona', 'Cumbal', 'El Charco', 'La Cruz', 'Policarpa', 'Pupiales', 'Francisco Pizarro', 'Santa Bárbara', 'Guachucal', 'Ricaurte', 'Sapuyes', 'Chachagüí', 'Tangua', 'Olaya Herrera', 'Magüi Payán', 'Mosquera', 'Linares', 'Yacuanquer'],
    'Norte de Santander': ['Cúcuta', 'Ocaña', 'Pamplona', 'Villa del Rosario', 'Los Patios', 'Tibú', 'El Zulia', 'Chinácota', 'Sardinata', 'Salazar', 'Puerto Santander', 'Convención', 'Teorama', 'Hacarí', 'Durania', 'Abrego', 'San Cayetano', 'El Tarra', 'Bucarasica', 'Cachirá', 'Toledo', 'Villa Caro', 'Gramalote', 'Lourdes', 'Ragonvalia'],
    'Putumayo': ['Mocoa', 'Puerto Asís', 'Valle del Guamuéz', 'Orito', 'Puerto Caicedo', 'Puerto Guzmán', 'Villagarzón', 'San Miguel', 'Puerto Leguízamo', 'Sibundoy', 'Colón', 'Santiago', 'San Francisco'],
    'Quindío': ['Armenia', 'Calarcá', 'Montenegro', 'La Tebaida', 'Quimbaya', 'Circasia', 'Filandia', 'Salento', 'Génova', 'Pijao', 'Córdoba', 'Buenavista'],
    'Risaralda': ['Pereira', 'Dosquebradas', 'La Virginia', 'Santa Rosa de Cabal', 'Marsella', 'Belén de Umbría', 'Quinchía', 'Apía', 'Santuario', 'Guática', 'Pueblo Rico', 'Mistrató', 'La Celia', 'Balboa'],
    'Santander': ['Bucaramanga', 'Floridablanca', 'Girón', 'Piedecuesta', 'Barrancabermeja', 'San Gil', 'Socorro', 'Málaga', 'Barbosa', 'Vélez', 'Sabana de Torres', 'Puerto Wilches', 'Lebrija', 'El Carmen de Chucurí', 'Simacota', 'Zapatoca', 'Betulia', 'Cimitarra', 'Capitanejo', 'Charalá', 'Landázuri', 'Mogotes', 'Onzaga', 'San Vicente de Chucurí', 'Rionegro', 'Suaita', 'Coromoro', 'Enciso', 'Guaca', 'Guapotá'],
    'Sucre': ['Sincelejo', 'Corozal', 'Sampués', 'Tolú', 'San Marcos', 'Majagual', 'San Onofre', 'Sincé', 'Morroa', 'Los Palmitos', 'Ovejas', 'San Pedro', 'Galeras', 'San Luis de Sincé', 'Tolú Viejo', 'La Unión', 'Caimito', 'Chalán', 'Guaranda', 'San Benito Abad', 'Buenavista', 'San Juan de Betulia', 'Santiago de Tolú', 'Palmito', 'Coloso'],
    'Tolima': ['Ibagué', 'Espinal', 'Melgar', 'Honda', 'Líbano', 'Chaparral', 'Mariquita', 'Purificación', 'Fresno', 'Guamo', 'Armero', 'Flandes', 'Ambalema', 'Cajamarca', 'Saldaña', 'Rovira', 'Venadillo', 'Planadas', 'Natagaima', 'Icononzo', 'Ortega', 'Dolores', 'Alvarado', 'Ataco', 'Rioblanco'],
    'Valle del Cauca': ['Cali', 'Palmira', 'Buenaventura', 'Tuluá', 'Cartago', 'Buga', 'Jamundí', 'Yumbo', 'Candelaria', 'Florida', 'Pradera', 'Roldanillo', 'Sevilla', 'Zarzal', 'El Cerrito', 'Dagua', 'Andalucía', 'Bugalagrande', 'La Unión', 'Vijes', 'Calima', 'Toro', 'La Cumbre', 'Restrepo', 'Trujillo', 'Bolívar', 'Versalles', 'Obando', 'El Águila', 'Ansermanuevo']
  };

  // Datos de departamentos/regiones por país
  const regionsByCountry = {
    'Colombia': [
      'Amazonas', 'Antioquia', 'Arauca', 'Atlántico', 'Bolívar', 'Boyacá', 
      'Caldas', 'Caquetá', 'Casanare', 'Cauca', 'Cesar', 'Chocó', 
      'Córdoba', 'Cundinamarca', 'Guainía', 'Guaviare', 'Huila', 
      'La Guajira', 'Magdalena', 'Meta', 'Nariño', 'Norte de Santander', 
      'Putumayo', 'Quindío', 'Risaralda', 'San Andrés y Providencia', 
      'Santander', 'Sucre', 'Tolima', 'Valle del Cauca', 'Vaupés', 'Vichada'
    ],
    'México': [
      'Aguascalientes', 'Baja California', 'Baja California Sur', 'Campeche', 
      'Chiapas', 'Chihuahua', 'Ciudad de México', 'Coahuila', 'Colima', 
      'Durango', 'Guanajuato', 'Guerrero', 'Hidalgo', 'Jalisco', 
      'Estado de México', 'Michoacán', 'Morelos', 'Nayarit', 'Nuevo León', 
      'Oaxaca', 'Puebla', 'Querétaro', 'Quintana Roo', 'San Luis Potosí', 
      'Sinaloa', 'Sonora', 'Tabasco', 'Tamaulipas', 'Tlaxcala', 
      'Veracruz', 'Yucatán', 'Zacatecas'
    ],
    'Argentina': [
      'Buenos Aires', 'Catamarca', 'Chaco', 'Chubut', 'Ciudad Autónoma de Buenos Aires',
      'Córdoba', 'Corrientes', 'Entre Ríos', 'Formosa', 'Jujuy', 'La Pampa',
      'La Rioja', 'Mendoza', 'Misiones', 'Neuquén', 'Río Negro', 'Salta',
      'San Juan', 'San Luis', 'Santa Cruz', 'Santa Fe', 'Santiago del Estero',
      'Tierra del Fuego', 'Tucumán'
    ],
    'España': [
      'Andalucía', 'Aragón', 'Asturias', 'Islas Baleares', 'Canarias',
      'Cantabria', 'Castilla-La Mancha', 'Castilla y León', 'Cataluña',
      'Comunidad Valenciana', 'Extremadura', 'Galicia', 'La Rioja',
      'Comunidad de Madrid', 'Región de Murcia', 'Navarra', 'País Vasco'
    ],
    'Estados Unidos': [
      'Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California', 'Colorado',
      'Connecticut', 'Delaware', 'Florida', 'Georgia', 'Hawaii', 'Idaho',
      'Illinois', 'Indiana', 'Iowa', 'Kansas', 'Kentucky', 'Louisiana',
      'Maine', 'Maryland', 'Massachusetts', 'Michigan', 'Minnesota',
      'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada',
      'New Hampshire', 'New Jersey', 'New Mexico', 'New York',
      'North Carolina', 'North Dakota', 'Ohio', 'Oklahoma', 'Oregon',
      'Pennsylvania', 'Rhode Island', 'South Carolina', 'South Dakota',
      'Tennessee', 'Texas', 'Utah', 'Vermont', 'Virginia', 'Washington',
      'West Virginia', 'Wisconsin', 'Wyoming'
    ],
    'Brasil': [
      'Acre', 'Alagoas', 'Amapá', 'Amazonas', 'Bahia', 'Ceará',
      'Distrito Federal', 'Espírito Santo', 'Goiás', 'Maranhão',
      'Mato Grosso', 'Mato Grosso do Sul', 'Minas Gerais', 'Pará',
      'Paraíba', 'Paraná', 'Pernambuco', 'Piauí', 'Rio de Janeiro',
      'Rio Grande do Norte', 'Rio Grande do Sul', 'Rondônia', 'Roraima',
      'Santa Catarina', 'São Paulo', 'Sergipe', 'Tocantins'
    ],
    'Perú': [
      'Amazonas', 'Áncash', 'Apurímac', 'Arequipa', 'Ayacucho', 'Cajamarca',
      'Callao', 'Cusco', 'Huancavelica', 'Huánuco', 'Ica', 'Junín',
      'La Libertad', 'Lambayeque', 'Lima', 'Loreto', 'Madre de Dios',
      'Moquegua', 'Pasco', 'Piura', 'Puno', 'San Martín', 'Tacna',
      'Tumbes', 'Ucayali'
    ],
    'Chile': [
      'Arica y Parinacota', 'Tarapacá', 'Antofagasta', 'Atacama', 'Coquimbo',
      'Valparaíso', 'Metropolitana de Santiago', 'O\'Higgins', 'Maule',
      'Ñuble', 'Biobío', 'La Araucanía', 'Los Ríos', 'Los Lagos',
      'Aysén', 'Magallanes'
    ],
    'Venezuela': [
      'Amazonas', 'Anzoátegui', 'Apure', 'Aragua', 'Barinas', 'Bolívar',
      'Carabobo', 'Cojedes', 'Delta Amacuro', 'Distrito Capital', 'Falcón',
      'Guárico', 'Lara', 'Mérida', 'Miranda', 'Monagas', 'Nueva Esparta',
      'Portuguesa', 'Sucre', 'Táchira', 'Trujillo', 'Vargas', 'Yaracuy', 'Zulia'
    ],
    'Ecuador': [
      'Azuay', 'Bolívar', 'Cañar', 'Carchi', 'Chimborazo', 'Cotopaxi',
      'El Oro', 'Esmeraldas', 'Galápagos', 'Guayas', 'Imbabura', 'Loja',
      'Los Ríos', 'Manabí', 'Morona Santiago', 'Napo', 'Orellana',
      'Pastaza', 'Pichincha', 'Santa Elena', 'Santo Domingo de los Tsáchilas',
      'Sucumbíos', 'Tungurahua', 'Zamora Chinchipe'
    ]
  };

  // Función para actualizar el campo de ciudad
  function updateCityField(department, currentValue) {
    const container = document.getElementById('city-container');
    if (!container) return;

    if (citiesByDepartment[department]) {
      // Crear select con las ciudades del departamento
      const cities = citiesByDepartment[department];
      let selectHTML = '<select name="curriculum[city]" id="city-field" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">';
      selectHTML += '<option value="">Seleccionar ciudad</option>';
      cities.forEach(city => {
        const selected = currentValue === city ? 'selected' : '';
        selectHTML += `<option value="${city}" ${selected}>${city}</option>`;
      });
      selectHTML += '</select>';
      container.innerHTML = selectHTML;
    } else {
      // Usar campo de texto para departamentos sin lista predefinida
      const value = currentValue || '';
      container.innerHTML = `<input type="text" name="curriculum[city]" id="city-field" value="${value}" placeholder="Ej: Bogotá" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">`;
    }
  }

  // Función para actualizar el campo de departamento
  function updateDepartmentField(country, currentValue, currentCity) {
    const container = document.getElementById('department-container');
    if (!container) return;

    if (regionsByCountry[country]) {
      // Crear select con las regiones del país
      const regions = regionsByCountry[country];
      // Si es Colombia y no hay valor actual, usar Córdoba por defecto
      const defaultValue = (country === 'Colombia' && !currentValue) ? 'Córdoba' : currentValue;
      let selectHTML = '<select name="curriculum[department]" id="department-field" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">';
      selectHTML += '<option value="">Seleccionar departamento/región</option>';
      regions.forEach(region => {
        const selected = defaultValue === region ? 'selected' : '';
        selectHTML += `<option value="${region}" ${selected}>${region}</option>`;
      });
      selectHTML += '</select>';
      container.innerHTML = selectHTML;
      
      // Agregar listener para cambios en departamento
      const departmentField = document.getElementById('department-field');
      if (departmentField) {
        departmentField.addEventListener('change', function() {
          updateCityField(this.value, '');
        });
        
        // Actualizar ciudad si hay un departamento seleccionado
        if (defaultValue && country === 'Colombia') {
          updateCityField(defaultValue, currentCity);
        }
      }
    } else {
      // Usar campo de texto para países sin lista predefinida
      const value = currentValue || '';
      container.innerHTML = `<input type="text" name="curriculum[department]" id="department-field" value="${value}" placeholder="Ej: Región, Estado, Provincia" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">`;
      // Resetear ciudad a campo de texto
      const cityContainer = document.getElementById('city-container');
      if (cityContainer) {
        const cityValue = document.getElementById('city-field') ? document.getElementById('city-field').value : '';
        cityContainer.innerHTML = `<input type="text" name="curriculum[city]" id="city-field" value="${cityValue}" placeholder="Ej: Ciudad" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">`;
      }
    }
  }

  // Obtener valores iniciales
  const initialDepartment = document.getElementById('department-field') ? document.getElementById('department-field').value : '';
  const initialCity = document.getElementById('city-field') ? document.getElementById('city-field').value : '';
  
  // Configurar el campo según el país inicial
  const countrySelect = document.getElementById('country-select');
  if (countrySelect) {
    const initialCountry = countrySelect.value || 'Colombia';
    const departmentValue = initialDepartment || (initialCountry === 'Colombia' ? 'Córdoba' : '');
    updateDepartmentField(initialCountry, departmentValue, initialCity);

    // Escuchar cambios en el país
    countrySelect.addEventListener('change', function() {
      updateDepartmentField(this.value, '', '');
    });
  }

  // Agregar idiomas
  const addLanguageBtn = document.getElementById('add-other-language-btn');
  if (addLanguageBtn) {
    addLanguageBtn.addEventListener('click', function(e) {
      e.preventDefault();
      const input = document.getElementById('new-other-language');
      const language = input.value.trim();
      
      if (!language) {
        alert('Por favor ingresa un idioma');
        return;
      }
      
      const container = document.getElementById('other-languages-container');
      const div = document.createElement('div');
      div.className = 'language-item';
      
      const span = document.createElement('span');
      span.textContent = language;
      
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'remove-other-language btn-remove';
      btn.dataset.language = language;
      btn.textContent = '×';
      
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        div.remove();
        updateOtherLanguagesHidden();
      });
      
      div.appendChild(span);
      div.appendChild(btn);
      container.appendChild(div);
      
      updateOtherLanguagesHidden();
      input.value = '';
    });
  }

  const newLanguageInput = document.getElementById('new-other-language');
  if (newLanguageInput) {
    newLanguageInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        document.getElementById('add-other-language-btn').click();
      }
    });
  }

  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('remove-other-language') && e.target.tagName === 'BUTTON') {
      e.preventDefault();
      e.target.parentElement.remove();
      updateOtherLanguagesHidden();
    }
  });

  function updateOtherLanguagesHidden() {
    const languages = Array.from(document.querySelectorAll('.remove-other-language')).map(btn => btn.dataset.language);
    const hiddenInput = document.getElementById('other-languages-hidden');
    if (hiddenInput) {
      hiddenInput.value = languages.join(',');
    }
  }

  // Funcionalidad para agregar/eliminar estudios dinámicamente
  let studyIndex = <%= curriculum.studies.size %>;

  const addStudyBtn = document.getElementById('add-study-btn');
  const educationLevelSelect = document.getElementById('education-level-select');
  
  // Función para controlar el estado del botón según nivel de estudios
  function updateAddStudyButton() {
    if (educationLevelSelect && addStudyBtn) {
      const selectedLevel = educationLevelSelect.value;
      console.log('Nivel seleccionado:', selectedLevel); // Para debug
      if (selectedLevel === 'ninguno' || selectedLevel === '') {
        addStudyBtn.disabled = true;
        addStudyBtn.style.opacity = '0.5';
        addStudyBtn.style.cursor = 'not-allowed';
      } else {
        addStudyBtn.disabled = false;
        addStudyBtn.style.opacity = '1';
        addStudyBtn.style.cursor = 'pointer';
      }
    }
  }
  
  // Ejecutar al cargar
  updateAddStudyButton();
  
  // Escuchar cambios en nivel de estudios
  if (educationLevelSelect) {
    educationLevelSelect.addEventListener('change', function() {
      console.log('Cambio detectado'); // Para debug
      updateAddStudyButton();
    });
  }
  
  if (addStudyBtn) {
    addStudyBtn.addEventListener('click', function(e) {
      e.preventDefault();
      
      // Verificar si está deshabilitado
      if (addStudyBtn.disabled) {
        console.log('Botón deshabilitado');
        return;
      }
      
      const container = document.getElementById('studies-container');
      const newStudy = document.createElement('div');
      newStudy.className = 'study-panel study-fields';
  
newStudy.innerHTML = `
  <div class="study-header">
    <h4>Estudio</h4>
    <button type="button" class="remove-study-btn btn btn-danger btn-sm">Eliminar</button>
  </div>

  <div class="form-group">
    <label for="curriculum_studies_attributes_${studyIndex}_institution">Institución *</label>
    <input type="text" name="curriculum[studies_attributes][${studyIndex}][institution]" id="curriculum_studies_attributes_${studyIndex}_institution" class="form-control">
  </div>

  <div class="form-group">
    <label for="curriculum_studies_attributes_${studyIndex}_status">Estado</label>
    <select name="curriculum[studies_attributes][${studyIndex}][status]" id="curriculum_studies_attributes_${studyIndex}_status" class="form-control">
      <option value="">Seleccionar</option>
      <option value="cursando">Cursando</option>
      <option value="pausado">Pausado</option>
      <option value="finalizado">Finalizado</option>
    </select>
  </div>

  <div class="form-grid-2">
    <div>
      <label for="curriculum_studies_attributes_${studyIndex}_start_date">Fecha Inicio</label>
      <input type="date" name="curriculum[studies_attributes][${studyIndex}][start_date]" id="curriculum_studies_attributes_${studyIndex}_start_date" class="form-control">
    </div>
    <div>
      <label for="curriculum_studies_attributes_${studyIndex}_end_date">Fecha Fin</label>
      <input type="date" name="curriculum[studies_attributes][${studyIndex}][end_date]" id="curriculum_studies_attributes_${studyIndex}_end_date" class="form-control">
    </div>
  </div>

  <div class="form-group form-group-no-margin">
    <label for="curriculum_studies_attributes_${studyIndex}_title">Título</label>
    <input type="text" name="curriculum[studies_attributes][${studyIndex}][title]" id="curriculum_studies_attributes_${studyIndex}_title" class="form-control">
  </div>
`;
  
  container.appendChild(newStudy);
  studyIndex++;
    });
  }

  // Event delegation para eliminar estudios
  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('remove-study-btn')) {
      e.preventDefault();
      const studyField = e.target.closest('.study-fields');
      
      // Si tiene un checkbox _destroy, marcarlo
      const destroyCheckbox = studyField.querySelector('input[type="checkbox"][name*="_destroy"]');
      if (destroyCheckbox) {
        destroyCheckbox.checked = true;
        studyField.style.display = 'none';
      } else {
        // Si es nuevo (sin ID), simplemente eliminarlo del DOM
        studyField.remove();
      }
    }
  });
});
</script>
