<div class="form-container">
  <div class="form-header">
    <h2>
      <%= curriculum.new_record? ? "Registrar Currículum" : "Editar Currículum" %>
    </h2>
  </div>

  <% if curriculum.errors.any? %>
    <div class="alert alert-danger">
      <h3 class="alert-title">Errores encontrados:</h3>
      <ul class="alert-list">
          <% curriculum.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
      </ul>
    </div>
  <% end %>

  <%= form_with(model: curriculum, local: true) do |form| %>
    <fieldset>
      <legend>Datos Personales</legend>

      <!-- Foto de Perfil -->
      <div class="form-group">
        <%= form.label :photo, "Foto de Perfil (JPEG o PNG, máximo 2 MB)" %>
        <%= form.file_field :photo, accept: "image/jpeg,image/png", style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
        <% if curriculum.persisted? && curriculum.photo.attached? %>
          <div class="current-photo">
            <img src="<%= url_for(curriculum.photo) %>" alt="Foto de perfil" class="photo-preview-img">
            <p>Foto actual</p>
          </div>
        <% end %>
      </div>

      <!-- Nombre -->
      <div class="form-group">
        <%= form.label :first_name, "Nombre(s)" %>
        <%= form.text_field :first_name, placeholder: "Ej: Juan", style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
      </div>

      <!-- Apellido -->
      <div class="form-group">
        <%= form.label :last_name, "Apellidos" %>
        <%= form.text_field :last_name, placeholder: "Ej: Pérez García", style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
      </div>

      <!-- Fecha de Nacimiento -->
      <div class="form-group">
        <%= form.label :birth_date, "Fecha de Nacimiento (debes ser mayor de 18 años)" %>
        <%= form.date_field :birth_date, style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
      </div>

      <!-- Identificación -->
      <div class="form-group">
        <%= form.label :identification, "Número de Identificación" %>
        <%= form.text_field :identification, placeholder: "Ej: 1234567890", style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
      </div>

      <!-- Teléfono -->
      <div class="form-group">
        <%= form.label :phone_number, "Teléfono" %>
        <%= form.text_field :phone_number, placeholder: "Ej: +57 300 1234567", style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
      </div>

      <!-- Dirección -->
      <div class="form-group">
        <%= form.label :address, "Dirección de Residencia" %>
        <%= form.text_field :address, placeholder: "Ej: Carrera 5", style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
      </div>

      <!-- Ubicación con Stimulus -->
      <div data-controller="location" 
           data-location-initial-department-value="<%= curriculum.department %>"
           data-location-initial-city-value="<%= curriculum.city %>">
        
        <!-- País -->
        <div class="form-group">
          <%= form.label :country, "País" %>
          <%= form.select :country, 
            [
              "Afganistán", "Albania", "Alemania", "Andorra", "Angola", "Antigua y Barbuda", "Arabia Saudita", "Argelia", "Argentina", "Armenia", "Australia", "Austria", "Azerbaiyán",
              "Bahamas", "Bangladés", "Barbados", "Baréin", "Bélgica", "Belice", "Benín", "Bielorrusia", "Birmania", "Bolivia", "Bosnia y Herzegovina", "Botsuana", "Brasil", "Brunéi", "Bulgaria", "Burkina Faso", "Burundi", "Bután",
              "Cabo Verde", "Camboya", "Camerún", "Canadá", "Catar", "Chad", "Chile", "China", "Chipre", "Ciudad del Vaticano", "Colombia", "Comoras", "Corea del Norte", "Corea del Sur", "Costa de Marfil", "Costa Rica", "Croacia", "Cuba",
              "Dinamarca", "Dominica",
              "Ecuador", "Egipto", "El Salvador", "Emiratos Árabes Unidos", "Eritrea", "Eslovaquia", "Eslovenia", "España", "Estados Unidos", "Estonia", "Etiopía",
              "Filipinas", "Finlandia", "Fiyi", "Francia",
              "Gabón", "Gambia", "Georgia", "Ghana", "Granada", "Grecia", "Guatemala", "Guinea", "Guinea Ecuatorial", "Guinea-Bisáu", "Guyana",
              "Haití", "Honduras", "Hungría",
              "India", "Indonesia", "Irak", "Irán", "Irlanda", "Islandia", "Islas Marshall", "Islas Salomón", "Israel", "Italia",
              "Jamaica", "Japón", "Jordania",
              "Kazajistán", "Kenia", "Kirguistán", "Kiribati", "Kuwait",
              "Laos", "Lesoto", "Letonia", "Líbano", "Liberia", "Libia", "Liechtenstein", "Lituania", "Luxemburgo",
              "Madagascar", "Malasia", "Malaui", "Maldivas", "Malí", "Malta", "Marruecos", "Mauricio", "Mauritania", "México", "Micronesia", "Moldavia", "Mónaco", "Mongolia", "Montenegro", "Mozambique",
              "Namibia", "Nauru", "Nepal", "Nicaragua", "Níger", "Nigeria", "Noruega", "Nueva Zelanda",
              "Omán",
              "Países Bajos", "Pakistán", "Palaos", "Panamá", "Papúa Nueva Guinea", "Paraguay", "Perú", "Polonia", "Portugal",
              "Reino Unido", "República Centroafricana", "República Checa", "República del Congo", "República Democrática del Congo", "República Dominicana", "Ruanda", "Rumania", "Rusia",
              "Samoa", "San Cristóbal y Nieves", "San Marino", "San Vicente y las Granadinas", "Santa Lucía", "Santo Tomé y Príncipe", "Senegal", "Serbia", "Seychelles", "Sierra Leona", "Singapur", "Siria", "Somalia", "Sri Lanka", "Suazilandia", "Sudáfrica", "Sudán", "Sudán del Sur", "Suecia", "Suiza", "Surinam",
              "Tailandia", "Tanzania", "Tayikistán", "Timor Oriental", "Togo", "Tonga", "Trinidad y Tobago", "Túnez", "Turkmenistán", "Turquía", "Tuvalu",
              "Ucrania", "Uganda", "Uruguay", "Uzbekistán",
              "Vanuatu", "Venezuela", "Vietnam",
              "Yemen",
              "Yibuti",
              "Zambia", "Zimbabue"
            ],
            { prompt: "Seleccionar país", selected: curriculum.country.present? ? curriculum.country : "Colombia" },
            { 
              style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;",
              data: { location_target: "country", action: "change->location#countryChanged" }
            }
          %>
        </div>

        <!-- Departamento -->
        <div class="form-group">
          <%= form.label :department, "Departamento/Región" %>
          <div data-location-target="departmentContainer">
            <%= form.text_field :department, placeholder: "Ej: Cundinamarca", style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
          </div>
        </div>

        <!-- Ciudad -->
        <div class="form-group">
          <%= form.label :city, "Ciudad" %>
          <div data-location-target="cityContainer">
            <%= form.text_field :city, placeholder: "Ej: Bogotá", style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
          </div>
        </div>
      </div>

      <!-- Perfil/Descripción Personal -->
      <div class="form-group">
        <%= form.label :profile_description, "Perfil o Descripción Personal" %>
        <%= form.text_area :profile_description, placeholder: "Describe tu perfil profesional...", rows: 5, style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" %>
        <small>Máximo 2000 caracteres</small>
      </div>

      <!-- Disponibilidad para Viajar -->
      <div class="form-group">
        <%= form.label :available_to_travel, "¿Disponibilidad para Viajar?" %>
        <div class="radio-group">
          <%= form.radio_button :available_to_travel, true %>
          <%= form.label :available_to_travel_true, "Sí" %>
          <%= form.radio_button :available_to_travel, false %>
          <%= form.label :available_to_travel_false, "No" %>
        </div>
      </div>

      <!-- Disponibilidad para Cambio de Residencia -->
      <div class="form-group">
        <%= form.label :available_to_relocate, "¿Disponibilidad para Cambio de Residencia?" %>
        <div class="radio-group">
          <%= form.radio_button :available_to_relocate, true %>
          <%= form.label :available_to_relocate_true, "Sí" %>
          <%= form.radio_button :available_to_relocate, false %>
          <%= form.label :available_to_relocate_false, "No" %>
        </div>
      </div>

      <!-- Idiomas con Stimulus -->
      <div class="form-group" data-controller="languages">
        <%= form.label :languages, "Idiomas" %>
        <div class="checkbox-container">
          <div class="checkbox-item">
            <label>
              <input type="checkbox" name="curriculum[languages][]" value="Español" <% if (curriculum.languages || []).include?('Español') %>checked<% end %>>
              Español
            </label>
          </div>
          <div class="checkbox-item">
            <label>
              <input type="checkbox" name="curriculum[languages][]" value="Inglés" <% if (curriculum.languages || []).include?('Inglés') %>checked<% end %>>
              Inglés
            </label>
          </div>
          <div class="other-languages-section">
            <p class="other-languages-label">Otros idiomas:</p>
            <div data-languages-target="container">
              <% (curriculum.languages || []).reject { |lang| ['Español', 'Inglés'].include?(lang) }.each do |lang| %>
                <div style="display: flex; align-items: center; margin-bottom: 5px;">
                  <input type="hidden" name="curriculum[languages][]" value="<%= lang %>">
                  <span style="margin-right: 10px;"><%= lang %></span>
                  <button type="button" 
                          data-action="click->languages#removeLanguage" 
                          style="background-color: #f44336; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px;">
                    Eliminar
                  </button>
                </div>
              <% end %>
            </div>
            <div class="language-input-group">
              <input type="text" 
                     data-languages-target="input" 
                     placeholder="Ej: Portugués, Francés, etc." 
                     class="language-input">
              <button type="button" 
                      data-action="click->languages#addLanguage" 
                      class="btn btn-primary btn-sm">
                Agregar
              </button>
            </div>
          </div>
          <input type="hidden" name="curriculum[languages][]" value="">
        </div>
      </div>

      <!-- Información Académica con Stimulus -->
      <div class="academic-section" data-controller="studies">
        <h3>Información Académica</h3>
        
        <!-- Nivel de Estudios (fuera del panel) -->
        <div class="form-group" style="display: flex; align-items: flex-end; gap: 10px;">
          <div style="flex: 1;">
            <%= form.label :education_level, "Nivel de Estudios", style: "display: block; margin-bottom: 5px; font-size: 14px; font-weight: 500;" %>
            <%= form.select :education_level, 
              [
                ['Ninguno', 'ninguno'], 
                ['Primaria', 'primaria'], 
                ['Secundaria', 'secundaria'], 
                ['Técnico', 'tecnico'], 
                ['Tecnólogo', 'tecnologico'], 
                ['Profesional', 'profesional'], 
                ['Posgrado', 'posgrado']
              ], 
              { prompt: 'Escoja el nivel de estudios' }, 
              { 
                style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; box-sizing: border-box;",
                data: { studies_target: "educationLevel", action: "change->studies#educationLevelChanged" }
              } 
            %>
          </div>
          <button type="button" 
                  data-studies-target="button"
                  data-action="click->studies#addStudy" 
                  class="btn btn-primary btn-sm" 
                  style="white-space: nowrap; padding: 10px 15px; opacity: 0.5; cursor: not-allowed;"
                  disabled>
            + Agregar Estudio
          </button>
        </div>
        
        <div data-studies-target="container">
          <%= form.fields_for :studies do |study_form| %>
            <div class="study-panel study-fields study-item">
              <div class="study-header">
                <h4>Estudio</h4>
                <%= study_form.check_box :_destroy, style: "display: none;" %>
                <button type="button" 
                        data-action="click->studies#removeStudy" 
                        class="btn btn-danger btn-sm">
                  Eliminar
                </button>
              </div>

              <div class="form-group">
                <%= study_form.label :institution, "Institución *", style: "display: block; margin-bottom: 5px; font-size: 14px; font-weight: 500;" %>
                <%= study_form.text_field :institution, style: "width: 100%; max-width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; box-sizing: border-box;" %>
              </div>

              <div class="form-group">
                <%= study_form.label :status, "Estado", style: "display: block; margin-bottom: 5px; font-size: 14px; font-weight: 500;" %>
                <%= study_form.select :status, [['Cursando', 'cursando'], ['Pausado', 'pausado'], ['Finalizado', 'finalizado']], { include_blank: 'Seleccionar' }, style: "width: 100%; max-width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; box-sizing: border-box;" %>
              </div>

              <div class="form-grid-2">
                <div>
                  <%= study_form.label :start_date, "Fecha Inicio", style: "display: block; margin-bottom: 5px; font-size: 14px; font-weight: 500;" %>
                  <%= study_form.date_field :start_date, style: "width: 100%; max-width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; box-sizing: border-box;" %>
                </div>
                <div>
                  <%= study_form.label :end_date, "Fecha Fin", style: "display: block; margin-bottom: 5px; font-size: 14px; font-weight: 500;" %>
                  <%= study_form.date_field :end_date, style: "width: 100%; max-width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; box-sizing: border-box;" %>
                </div>
              </div>

              <div class="form-group form-group-no-margin">
                <%= study_form.label :title, "Título", class: "form-label" %>
                <%= study_form.text_field :title, class: "form-control" %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </fieldset>

    <!-- Botones de acción -->
    <div class="form-actions">
      <% submit_text = curriculum.new_record? ? "Registrar Currículum" : "Actualizar Currículum" %>
      <button type="submit" class="btn btn-success btn-full"><%= submit_text %></button>
      <%= link_to "Cancelar", root_path, style: "flex: 1; padding: 10px; background-color: #6c757d; color: white; text-decoration: none; border-radius: 4px; text-align: center;" %>
    </div>
  <% end %>
</div>

